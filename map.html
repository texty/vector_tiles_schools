<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <link rel='stylesheet' href="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css" />
  <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.css'  type='text/css'/>

</head>
<body>
  <style>
    #map {
      width:100%;
      height: 90vh;
    }
  </style>

<div id="map" class="container"></div>


<!-- перемикачі -->
<!-- <div class="buttons" id="ukraine-switch-buttons">
  <div class="map_button" value="MAP_infections10">приватна вечірка – 10 людей</div>
  <div class="map_button" value="MAP_infections100">бенкет – 100 людей</div>
  <div class="map_button" value="MAP_infections500">концерт – 500 людей</div>
  <div class="map_button active" value="MAP_infections1000">спортивна гра – 1000 людей</div>
</div> -->

<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js"></script>
<script type="text/javascript" src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.min.js"></script>
<script src="https://texty.org.ua/documents/12/d3v5.min.js"></script>

<script>
var default_zoom_u = window.innerWidth > 800 ? 8 : 8;

var stops_values = [
    [200, 1.5],
    [500, 2],
    [1000, 3],
    [2000, 4],
    [10000, 5]
];

mapboxgl.accessToken = 'pk.eyJ1IjoiZHJpbWFjdXMxODIiLCJhIjoiWGQ5TFJuayJ9.6sQHpjf_UDLXtEsz8MnjXw';

var map = new mapboxgl.Map({
    container: 'map',
    minZoom: 5,
    maxZoom: 9.5,
    hash: false,
    tap: false,
    attributionControl: false,
    style: 'mapbox://styles/mapbox/empty-v8',
    center: [31.5, 48.5],
    zoom: 5 // starting zoom
});



// map.scrollZoom.disable();

var popup;


/* ------- карта України ------- */
map.on('load', function () {


    var layers = map.getStyle().layers;
    var firstSymbolId;

    for (var i = 0; i < layers.length; i++) {
        if (layers[i].type === 'symbol') {
            firstSymbolId = layers[i].id;
            break;
        }
    }

    map.addSource('polygon-source', {
        'type': 'geojson',
        'data': 'OccupiedTerritory_1.geojson'
    });

    // Add a layer using the GeoJSON data
    map.addLayer({
        'id': 'polygon-layer',
        'type': 'fill',
        'source': 'polygon-source',
        'paint': {
            'fill-color': '#e8a598', // Adjust fill color and opacity as needed
            'fill-outline-color': '#e8a598', // Adjust outline color as needed
            'fill-opacity': 0.2 // Adjust fill opacity as needed
        }
    });



    //векторні тайли
    map.addSource('schools', {
        type: 'vector',
        tiles: ["https://texty.github.io/vector_tiles_schools/schools_tiles/{z}/{x}/{y}.pbf"]
    });


    function redrawUkraineMap() {
        map.addLayer({
            "id": "schools_data",
            'type': 'circle',
            'minzoom': 4,
            'maxzoom': 10,
            'source': "schools",
            "source-layer": "data_in_4326",
            "paint": {
              'circle-radius': [
                'interpolate', ['linear'],
                ['get', 'total'], // Property name
                // Property value, radius pairs
                0, 1,
                100, 2, // Default radius if property value is less than the first stop value
                // Stop values and their corresponding radius values
                
                500, 4,
                1000, 5,
                2000, 6,
                10000, 10
            ],
              'circle-color': [
                'match',
                ['get', 'color'], // Property name
                'змішано', 'rgb(28, 72, 112)', // Property value and corresponding color
                'дистанційно', 'rgb(219, 128, 128)',
                'rgb(127, 180, 141)' // Default color if no match found
            ],
            'circle-opacity': 1, // Adjust the opacity of the circle
            'circle-stroke-width': 0.1, // Adjust the width of the circle stroke
            'circle-stroke-color': 'white' // Adjust the color of the circle stroke
        
            },
            'minzoom': 5,
            'layerOptions': {
            'filter': ['==', '$type', 'Point'] // Фільтрувати лише точкові об'єкти
        }
        });



    }

    // function sourceCallback() {
    //     if (map.getSource('schools') && map.isSourceLoaded('schools') && map.isStyleLoaded()) {
    //         d3.select(".spinner").remove();
    //     }
    // }        //

    // map.on('sourcedata', sourceCallback);



    redrawUkraineMap();

    // /* перемикаємо шари  карти */
    // d3.select("#ukraine-switch-buttons").selectAll(".map_button").on("click", function() {
    //     let selected_layer = d3.select(this).attr("value");
    //     d3.select(this.parentNode).selectAll(".map_button").classed("active", false);
    //     d3.select(this).classed("active", true);
    //     $('.mapboxgl-popup').remove();
    //     map.removeLayer('schools_data');
    //     redrawUkraineMap(selected_layer);

    // });


    var nav = new mapboxgl.NavigationControl();
    map.addControl(nav, 'top-left');

}); //end of Ukraine map

</script>

</body>
</html><!-- Для проєкту по ковід-вечіркам -->